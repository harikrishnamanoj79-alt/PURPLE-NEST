{% extends 'admin_base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_assign_delivery.css' %}">
{% endblock %}

{% block content %}

<div class="admin-container">

  <!-- PAGE HEADER -->
  <div class="page-header">
    <h1>Assign Delivery</h1>
    <p>Manage delivery personnel for Order #{{ order.id }}</p>
  </div>

  <!-- ORDER DETAILS -->
  <div class="order-summary">
    <h2>Order Summary</h2>
    <ul>
      <li><strong>Customer:</strong> {{ order.user.username }}</li>
      <li><strong>Email:</strong> {{ order.user.email }}</li>
      <li><strong>Order Date:</strong> {{ order.created_at|date:"M d, Y" }}</li>
      <li><strong>Total Amount:</strong> ₹{{ order.total_amount }}</li>
      <li><strong>Status:</strong> {{ order.status }}</li>
      <li><strong>Delivery Address:</strong> {{ order.address }}</li>
    </ul>
  </div>

  <!-- PRODUCT LIST -->
  <div class="order-items">
    <h2>Ordered Items</h2>
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        {% for item in order.items.all %}
        <tr>
          <td>{{ item.product.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>₹{{ item.subtotal }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ASSIGN DELIVERY FORM -->
  <div class="assign-delivery">
    <h2>Assign Delivery Person</h2>
    <form method="POST" action="{% url 'assign_delivery' order.id %}">
      {% csrf_token %}
      <label for="delivery_person">Select Delivery Person:</label>
      <select name="delivery_person" id="delivery_person" required>
        <option value="">-- Choose --</option>
        {% for person in delivery_persons %}
          <option value="{{ person.id }}" {% if order.assigned_to == person %}selected{% endif %}>
            {{ person.username }}
          </option>
        {% endfor %}
      </select>
      <button type="submit" class="btn">Assign</button>
    </form>
  </div>

</div>

{% endblock %}
