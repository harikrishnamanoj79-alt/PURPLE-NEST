{% extends 'admin_base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_manage_users.css' %}">
{% endblock %}

{% block content %}
<div class="admin-container">

  <!-- PAGE HEADER -->
  <div class="page-header">
    <h1>Manage Users</h1>
    <p>View and control registered users in the system.</p>
  </div>

  <!-- FILTER BAR -->
  <div class="filter-bar">
    <form method="get">
      <select name="role" onchange="this.form.submit()">
        <option value="">All Roles</option>
        <option value="customer" {% if request.GET.role == 'customer' %}selected{% endif %}>Customers</option>
        <option value="delivery" {% if request.GET.role == 'Delivery' %}selected{% endif %}>Delivery Staff</option>
        <option value="admin" {% if request.GET.role == 'admin' %}selected{% endif %}>Admins</option>
      </select>
    </form>
  </div>

  <!-- USER TABLE -->
  <div class="user-table">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Role</th>
          <th>Phone</th>
          <th>Joined</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.id }}</td>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.role|title }}</td>
          <td>{{ user.phone|default:"â€”" }}</td>
          <td>{{ user.date_joined|date:"M d, Y" }}</td>
          <td>
            {% if user.is_active %}
              <span class="status active">Active</span>
            {% else %}
              <span class="status blocked">Blocked</span>
            {% endif %}
          </td>
          <td class="actions">
            {% if user.is_active %}
              <a href="{% url 'block_user' user.id %}" class="btn small danger">Block</a>
            {% else %}
              <a href="{% url 'unblock_user' user.id %}" class="btn small success">Unblock</a>
            {% endif %}

            {% if user.role != 'admin' %}
              <a href="{% url 'promote_user' user.id %}" class="btn small">Promote</a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="8">No users found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
